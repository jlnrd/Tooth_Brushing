---
title: "Daily Fluctuations in Teeth Brushing Pilot"
output: html_document
---

<style type="text/css">
h1 {
  font-size: 36px;
  margin-top: 60px;
  margin-bottom: 30px;
}

h2 {
  font-size: 28px;

}

h3 {
  font-size: 24px;
  padding-top: 30px;
  margin-bottom: 0px;
  text-align: left !important;
}

h4 {
  font-size: 18px;
}

p {
  font-size: 16px;
  text-align: left;
}

h1, h2, h3, h4, h5, h6 {
  text-align: center;
}

.p-text-align-right {
  text-align: right !important;
}

</style>

```{r, include=FALSE,warning=FALSE}
# clean workspace
rm(list=ls())

# load required packages
packages <- c("ggplot2", "ggpubr", "PerformanceAnalytics")
lapply(packages, library, character.only = TRUE)

# standardize ggplot2
theme_set(theme_bw() + theme( plot.title = element_text(size=18, lineheight=1, margin=margin(b=15, t=30), hjust = 0.5),
         axis.title.x = element_text(size=14, lineheight=1, margin=margin(t=15)),
         axis.title.y = element_text(size=14, lineheight=1, margin=margin(r=15))))

##################
## read in data ##
##################
participant_background_information<-read.csv("/Users/appollo_liu/Documents/workspace/Tooth_Brushing/data/parent_q_clean_n19.csv", header=TRUE)
daily_fluctuations<-read.csv("/Users/appollo_liu/Documents/workspace/Tooth_Brushing/data/pilot_041919_merged_n19.csv", header=TRUE)

data<-merge(participant_background_information, daily_fluctuations, by="subject")
# exclude subject 115
data<-data[!grepl(115, data$subject),]

# makes each "key" in the data object its own variable
# Example: data$record_id is now record_id
attach(data)
```

### Subject box plots

```{r,warning=FALSE,fig.width=10, fig.height=8,echo = FALSE}
# plot subject brushing length
brushing_length_vs_subject <- ggplot(data=data, mapping=aes(x=as.factor(subject), y=time_brushing))
brushing_length_vs_subject +
  geom_boxplot() +
  stat_summary(fun.y="mean", geom="point", shape=9, size=3) +
  labs(title="Subject Brushing Length", x="Subject",y="Brushing length (seconds)")
```  

<p>
  Some subjets (101, 102, 104, 106, 110, 113, 116, 118) have large differences in brushing length between days which is shown by the large difference between the third and first quartile. Other subjects like 100, 112, 114, and 117 have smaller interquartile ranges, suggesting that their brushing lengths do not vary as much.
</p>

```{r,warning=FALSE,fig.width=10, fig.height=8,echo = FALSE}
# plot subject sleep
sleep_length_vs_subject <- ggplot(data=data, mapping=aes(x=as.factor(subject), y=time_sleep))
sleep_length_vs_subject +
  geom_boxplot() +
  stat_summary(fun.y="mean", geom="point", shape=9, size=3) +
  labs(title="Subject Sleep", x="Subject",y="Sleep (hours)")
```

<p>
  The majority of subjects also seem to vary in the amount of sleep they get, ranging from about 9 to 13 hours with the exception of subject 103 who had a relatively stable 11.5 hours of sleep with a few exceptions.
</p>

```{r,warning=FALSE,fig.width=10, fig.height=8,echo = FALSE}
# plot subject's parent stress
parent_stress_vs_subject <- ggplot(data=data, mapping=aes(x=as.factor(subject), y=parent_stress))
parent_stress_vs_subject +
  geom_boxplot() +
  stat_summary(fun.y="mean", geom="point", shape=9, size=3) +
  labs(title="Parent Stress", x="Subject",y="Parent stress level")
```

<p>
  Similar to child sleep length, parent stress level varies from day to day with the exception of subject 106's parent. Note: this only accounts for the stress level of the parent submitting the survey.
</p>

### Relationships between Brushing length, Sleep, and Parent Stress

```{r,warning=FALSE,fig.width=10, fig.height=8,echo = FALSE}
# plot brushing length vs. sleep
brushing_length_vs_sleep <- ggplot(data=data, mapping=aes(x=time_sleep, y=time_brushing, color=as.factor(subject)))
brushing_length_vs_sleep +
  stat_cor(method = "pearson",  size = 6) +
  geom_smooth(method=lm, se=FALSE, fullrange=TRUE) +
  geom_point(shape=1) +
  labs(title="Brushing Length vs. Sleep", x="Sleep (hours)", y="Brushing length (seconds)", color="Subject")
```

<p>
  Despite the expected relationship between brushing length and amount of sleep, only a few subject's brushing length significantly correlated with their sleep. Subjects 105 and 114 almost have statistically significant correlations, but subject 105's correlation is positive while subject 114's is negative. Subjects 117 and 118 have a p value < 0.05, but while subject 117 has a high positive correlation, subject 118 has a negative correlation. There doesn't seem to be a clear relationship between brushing length and sleep, atleast within this pilot study.
</p>

```{r,warning=FALSE,fig.width=10, fig.height=8,echo = FALSE}
# plot child sleep vs. parent stress
child_sleep_vs_parent_stress <- ggplot(data=data, mapping=aes(x=parent_stress, y=time_sleep, color=as.factor(subject)))
child_sleep_vs_parent_stress +
  stat_cor(method = "pearson",  size = 6) +
  geom_smooth(method=lm, se=FALSE, fullrange=TRUE) +
  geom_point(shape=1) +
  labs(title="Child Sleep vs. Parent Stress", x="Parent stress", y=" Child sleep (hours)", color="Subject")
```

<p>
  Subjects 101, 110, and 114 have a p value < 0.05, and although subjects 101 and 114 have large negative correlations between parent stress and child sleep, subject 110 has a large positive correlation between child sleep and parent stress. Similar to brushing length, there doesn't seem to be a significant relationship between child sleep and parent stress.
</p>

```{r,warning=FALSE,fig.width=10, fig.height=8,echo = FALSE}
# plot brushing length vs. parent stress
brushing_length_vs_parent_stress <- ggplot(data=data, mapping=aes(x=parent_stress, y=time_brushing, color=as.factor(subject)))
brushing_length_vs_parent_stress +
  stat_cor(method = "pearson",  size = 6) +
  geom_smooth(method=lm, se=FALSE, fullrange=TRUE) +
  geom_point(shape=1) +
  labs(title="Brushing Length vs. Parent Stress", x="Parent stress", y="Brushing length (seconds)", color="Subject")
```

<p>
  Although subjects 101, 106, and 107 have a p value between 0.05 and 0.10 and subject 110 has a p value < 0.05, the relationship is unclear because subject 101's positive correlation between brushing length and parent stress contrasts the other subjects' negative correlation between brushing length and parent stress.
</p>

### Daily Fluctuations Correlation Matrix

```{r,warning=FALSE,fig.width=10, fig.height=8,echo = FALSE}
# find the averages of daily fluctations for each subject
average_time_brushing <- with(data, ave(time_brushing, subject, FUN=function(x) mean(x, na.rm=TRUE)))
average_encouragement <- with(data, ave(encouragement, subject, FUN=function(x) mean(x, na.rm=TRUE)))
average_parent_stress <- with(data, ave(parent_stress, subject, FUN=function(x) mean(x, na.rm=TRUE)))
average_parent_mood <- with(data, ave(parent_mood, subject, FUN=function(x) mean(x, na.rm=TRUE)))
average_child_mood <- with(data, ave(child_mood, subject, FUN=function(x) mean(x, na.rm=TRUE)))
average_time_sleep <- with(data, ave(time_sleep, subject, FUN=function(x) mean(x, na.rm=TRUE)))
average_time_sleep_nonap <- with(data, ave(time_sleep_nonap, subject, FUN=function(x) mean(x, na.rm=TRUE)))

# cbind() combines two matrices that have the same number of rows together
combined_daily_fluctuations <- cbind(average_time_brushing, average_encouragement, average_parent_stress, average_parent_mood, average_child_mood, average_time_sleep, average_time_sleep_nonap)
# graphing the correlation matrix
# pch controls the type of point that is displayed in the scatter plots
chart.Correlation(combined_daily_fluctuations, histogram=TRUE, pch=19)
```

<p>
  The across subject correlation matrix suggests quite a few statistically significant correlations. Some of the mean positive correlations are relatively expected: brushing length and number of encouragements; parent mood and child mood; and number of encouragements and parent mood. Some of the mean negative correlations are relatively expected: encouragement and parent stress; parent stress and parent mood; and parent stress and child mood.
  
  However, some of the relationships are more novel and interesting. Although brushing length and parent stress have the expected negative correlation and brushing length and parent mood have the expected positive correlation, there doesn't seem to be a significant correlation between brushing length and child mood despite the connection between parent mood and child mood. In addition, child sleep has significant correlations with other daily fluctuations. 
  
  The most unexpected relationship is the negative correlation between brushing length and sleep which may be due to the large negative correlation between parent encouragement and child sleep. Assuming that parent encouragement connects with parent stress and parent mood, it's surprising that parent encouragement decreases with increasing child sleep despite parent mood increasing with child sleep. As a check, there is a positive correlation between child mood and child sleep as expected. One possible explanation is that parents don't believe that they need to be as engaged in encouragement when they know that their child has gotten plenty of sleep and has a relatively good mood. The parents' expectations that their child should be able to brush their teeth without their praise, cheering, instruction, etc. may cause them to become less involved and lead to the child brushing their teeth for a shorter amount of time. It would be very interesting to see if this pattern and the correlation between brushing length and child mood is similar in the fourth pilot.
  
  Because the parents submit the surveys after their child brushes their teeth, I would have expected that child mood would have correlated with brushing length. Since the parent likely recently finished watching their child brush their teeth, I thought that the parent might put more weight on the child's recent teeth brushing when determining the child's mood.
</p>

### Connecting Background Information and Daily Measurements  

<div style="padding-top:30px;">

```{r,warning=FALSE}

# find the average parent stress for each subject
average_parent_stress <- with(data, ave(parent_stress, subject, FUN=function(x) mean(x, na.rm=TRUE)))
# plot average stress level vs. parent perceived stress sum
average_stress_vs_parent_perceived_stress <- ggplot(data=data, mapping=aes(x=pss_sum, y=average_parent_stress))

```

```{r,warning=FALSE,fig.width=10, fig.height=8,echo = FALSE}
average_stress_vs_parent_perceived_stress +
  stat_cor(method = "pearson",  size = 6) +
  geom_smooth(method=lm, se=FALSE, fullrange=TRUE) +
  geom_point(shape=1) +
  labs(title="Average Stress vs. Parent Perceived Stress Sum", x="Parent perceived stress sum", y="Average stress")
```

<p>
  Shows that Parent Perceived Stress (PPS) has a high correlation with average parent stress. This suggests that PPS is a good indicator of average stress that a parent will have.
</p>

### Possible Future Analysis  

<p style="padding-top:30px;">
  While subjects brushed their teeth, parents would sometimes get distracted by other siblings. The forced divide in how parents devote their time between children might influence brushing length, but finding a correlation may not lead to anything because there doesn't seem to be a way to act on the finding even if there was one. Also, with so few subjects with siblings, finding a statistically significant correlation between the number of siblings and brushing length may be too difficult for the size of the pilot studies.
</p>

<p>
  For the fourth pilot, the subject and parent's moods seemed to affect the brushing length. This contrasts the lack of a relationship between the subject and parent's moods on brushing length in the given pilot study data. 
</p>

<p>
  Because there were quite a few more encouragements catagorized as "other" in the fourth pilot, it may be beneficial to look at the relationship between brushing length and encouragement twice: one time with "other" encouragements and one time without "other" encouragements.
</p>

<p>
  While the results from this pilot study did not seem to show a relationship between brushing length, child mood, and time asleep, combining a few factors might lead to better predictions of brushing length. For example, weighing encouragement, parent mood, and time asleep might correlate with brushing length. It would also be interesting to compare the daily fluctuations with the best and worst brushing length days similar to the Praise vs. Average group best and worst brushing night graph, but for all the daily variables.
</p>
<div style="height:60px;">
</div>